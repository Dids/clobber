# Disable sudo to enable containerization
sudo: false

# Setup Go language support
language: go

# Setup global environment variables
env:
  - TEST_COMMAND="go test -race -coverprofile=coverage.txt -covermode=atomic ./..."

# Setup Go version specific configurations
matrix:
  include:
  - go: master
  - go: 1.10.x
  - go: 1.9.x
    env:
      - TEST_COMMAND="echo \"Tests disabled for this version of Go\""
  # NOTE: Clobber is no longer compatible with version 1.8.x
  #- go: 1.8.x
  #  env:
  #    - TEST_COMMAND="echo \"Tests disabled for this version of Go\""

# Setup caching
cache:
  directories:
    - $HOME/.clobber/opt

# Install dependencies
install:
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  - dep ensure
  #- go get -u github.com/gobuffalo/packr/...

# Run tests and generate code coverage
script:
  - eval $TEST_COMMAND
  #- go build -o clobber
  #- packr build -o clobber
  - .scripts/build.sh
  - ./clobber --version

# Upload code coverage
after_success:
- bash <(curl -s https://codecov.io/bash)
